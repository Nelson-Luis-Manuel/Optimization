
clc;
clear;
close all;

%%====================== PURE MATLAB ===========================
%% DC Motor Parameters:
 
% Armature Voltage :
% V = 200;       %[V] 
% Armature Resistor :  
Ra = 0.4;      %[ohm] 
% Armature Inductance :
La = 2.7;    %[H]
% Tork constant:  
Kt = 0.015;      %[N.m/A]  
% Rotor inertia:
Jm = 0.0004;      %[Kg.m2]
% Electromotive Force:
Kb = 0.05;     %[V.s/rad]  
% Viscous Friction: 
Bm = 0.0022;    %[N.m.s/rad] 

%% Case 1
% Kt = 0.012; 
% Ra = 0.30;

%% Case 2
% Kt = 0.012;
% Ra = 0.50;

%% Case 3
% Kt = 0.018;
% Ra = 0.30;

%% Case 4
% Kt = 0.018;
% Ra = 0.50;

%% Optimal K's

% RealkEO      = round([20,5.34425126015290,3.54096912186557,0.000413151175030922],10);
% RealkPSO     = round([20,5.34412488294199,3.54086364042472,0.000413169674631571],10);
% RealkSanTLBO = round([20,5.34425346271171,3.54097039161424,0.000413151119864631],10);
% RealkDE      = round([20,5.34244496425179,3.53959692529223,0.000413737439221813],10);
% RealkGA      = round([20,5.35327100136485,3.54700499169861,0.000418725789973355],10);

%ITAE_Fuzzy = [2.3353e-07]

kEO       = round([20, 5.3443, 3.5410, 4.1317e-04],3);
kPSO      = round([20, 5.3441, 3.5409, 4.1317e-04],3);
kSanTLBO  = round([20, 5.3443, 3.5410, 4.1317e-04],3);
kDE       = round([20, 5.3424, 3.5396, 4.1374e-04],3);
kGA       = round([20, 5.3533, 3.5470, 4.1873e-04],3);

% For comparison purpose:
OBL_HGSO = [16.9327 0.9508 2.8512];
HGSO     = [13.4430 1.2059 2.2707];


% Load Fuzzy Controller
FLC_Controller_updated = readfis('FLC_Controller_updated');

figure(1)
col = {'Kp','Ki','Kd'};
row = {'EO','PSO','TLBO','DE','GA'};
dat = {num2str(kEO(1)),num2str(kEO(2)),num2str(kEO(3));...
       num2str(kPSO(1)),num2str(kPSO(2)),num2str(kPSO(3));...
       num2str(kSanTLBO(1)),num2str(kSanTLBO(2)),num2str(kSanTLBO(3));...
       num2str(kDE(1)),num2str(kDE(2)),num2str(kDE(3));...
       num2str(kGA(1)),num2str(kGA(2)),num2str(kGA(3))...
       };
uitable('columnname',col,'rowname',row,'position',[10 120 390 300],'data',dat);


%% EO-PID
% Kp_1 = kEO(1); Ki_1 = kEO(2); Kd_1 = kEO(3);
numer1 = [Kt*kEO(3) Kt*kEO(1) Kt*kEO(2)];
denom1 = [La*Jm (La*Bm + Ra*Jm + Kt*kEO(3)) (Ra*Bm + Kb*Kt + Kt*kEO(1))  Kt*kEO(2)];
  sys1 = tf(numer1, denom1);
% sys1 = tf([15*Kd_1,15*Kp_1,15*Ki_1],[1.08,(6.1+15*Kd_1),(1.63+15*Kp_1),(15*Ki_1)]);

%% PSO-PID
% Kp_2 = kPSO(1); Ki_2 = kPSO(2); Kd_2 = kPSO(3);
numer2 = [Kt*kPSO(3) Kt*kPSO(1) Kt*kPSO(2)];
denom2 = [La*Jm (La*Bm + Ra*Jm + Kt*kPSO(3)) (Ra*Bm + Kb*Kt + Kt*kPSO(1))  Kt*kPSO(2)];
  sys2 = tf(numer2, denom2);
% sys2 = tf([15*Kd_2,15*Kp_2,15*Ki_2],[1.08,(6.1+15*Kd_2),(1.63+15*Kp_2),(15*Ki_2)]);

%% TLBO-PID
% Kp_3 = kSanTLBO(1); Ki_3 = kSanTLBO(2); Kd_3 = kSanTLBO(3);
numer3 = [Kt*kSanTLBO(3) Kt*kSanTLBO(1) Kt*kSanTLBO(2)];
denom3 = [La*Jm (La*Bm + Ra*Jm + Kt*kSanTLBO(3)) (Ra*Bm + Kb*Kt + Kt*kSanTLBO(1))  Kt*kSanTLBO(2)];
  sys3 = tf(numer3, denom3);
% sys3 = tf([15*Kd_3,15*Kp_3,15*Ki_3],[1.08,(6.1+15*Kd_3),(1.63+15*Kp_3),(15*Ki_3)]);

%% DE-PID
% Kp_4 = kDE(1); Ki_4 = kDE(2); Kd_4 = kDE(3);
numer4 = [Kt*kDE(3) Kt*kDE(1) Kt*kDE(2)];
denom4 = [La*Jm (La*Bm + Ra*Jm + Kt*kDE(3)) (Ra*Bm + Kb*Kt + Kt*kDE(1))  Kt*kDE(2)];
  sys4 = tf(numer4, denom4);
% sys4 = tf([15*Kd_4,15*Kp_4,15*Ki_4],[1.08,(6.1+15*Kd_4),(1.63+15*Kp_4),(15*Ki_4)]);

%% GA-PID
% Kp_5 = kGA(1); Ki_5 = kGA(2); Kd_5 = kGA(3);
numer5 = [Kt*kGA(3) Kt*kGA(1) Kt*kGA(2)];
denom5 = [La*Jm (La*Bm + Ra*Jm + Kt*kGA(3)) (Ra*Bm + Kb*Kt + Kt*kGA(1))  Kt*kGA(2)];
  sys5 = tf(numer5, denom5);
% sys5 = tf([15*Kd_5,15*Kp_5,15*Ki_5],[1.08,(6.1+15*Kd_5),(1.63+15*Kp_5),(15*Ki_5)]);

%% Bode Plots
figure(2)
bode(sys1,'b',sys2,'g',sys3,'m--',sys4,'c:',sys5,'r-.');
grid on;
legend('EO','PSO','TLBO','DE','GA');
%% Step Response
figure(3)
[sys1_y,sys1_t] = step(sys1,1.2); [sys2_y,sys2_t] = step(sys2,1.2); [sys3_y,sys3_t] = step(sys3,1.2); [sys4_y,sys4_t] = step(sys4,1.2); [sys5_y,sys5_t] = step(sys5,1.2);
ref_y = ones(size(sys1_t));
plot(sys1_t,ref_y,'k','LineWidth',1.5);
hold on
plot(sys1_t,sys1_y,'b','LineWidth',1.5);
plot(sys2_t,sys2_y,'m--','LineWidth',1.5);
plot(sys3_t,sys3_y,'c:','LineWidth',1.5);
plot(sys4_t,sys4_y,'g-.','LineWidth',1.5);
plot(sys5_t,sys5_y,'r--','LineWidth',1.5);
%plot(out.w_out_FLC.Time,out.w_out_FLC.Data,'b','LineWidth',1.5);

ylabel('Speed');
xlabel('Time (s)');
title('Step Response');
legend('','EO','PSO','TLBO','DE','GA','FLC');
set(findall(gcf,'type','line'),'linewidth',1.25);

%% RiseTime, Settling Time and OverShoot
info1 = stepinfo(sys1);
info2 = stepinfo(sys2);
info3 = stepinfo(sys3);
info4 = stepinfo(sys4);
info5 = stepinfo(sys5);

% info1.RiseTime
% info1.SettlingTime
% info1.Overshoot

% info2.RiseTime
% info2.SettlingTime
% info2.Overshoot

% info3.RiseTime
% info3.SettlingTime
% info3.Overshoot

% info4.RiseTime
% info4.SettlingTime
% info4.Overshoot

% info5.RiseTime
% info5.SettlingTime
% info5.Overshoot

figure(4)
X = categorical({'EO','PSO','TLBO','DE','GA'});
X = reordercats(X,{'EO','PSO','TLBO','DE','GA'});
Y = [info1.RiseTime,info2.RiseTime,info3.RiseTime,info4.RiseTime,info5.RiseTime];
bar(X,Y,'b');
ylabel('Rise Time (s)');
grid on

figure(5)
X = categorical({'EO','PSO','TLBO','DE','GA'});
X = reordercats(X,{'EO','PSO','TLBO','DE','GA'});
Y = [info1.SettlingTime,info2.SettlingTime,info3.SettlingTime,info4.SettlingTime,info5.SettlingTime];
bar(X,Y,'b');
ylabel('Settling Time (s)');
grid on
 
figure(6)
X = categorical({'EO','PSO','TLBO','DE','GA'});
X = reordercats(X,{'EO','PSO','TLBO','DE','GA'});
Y = [info1.Overshoot,info2.Overshoot,info3.Overshoot,info4.Overshoot,info5.Overshoot];
bar(X,Y,'b');
ylim([0,1]);
ylabel('Overshoot (%)');
grid on

%% Gain Margin , Phase Margin  and BandWidth

% Gain Margin (GM) and Phase Margin (PM):
[Gm1,Pm1,Wcg1,Wcp1] = margin(sys1);
[Gm2,Pm2,Wcg2,Wcp2] = margin(sys2);
[Gm3,Pm3,Wcg3,Wcp3] = margin(sys3);
[Gm4,Pm4,Wcg4,Wcp4] = margin(sys4);
[Gm5,Pm5,Wcg5,Wcp5] = margin(sys5);

% BandWidth:
bw1 = bandwidth(sys1);
bw2 = bandwidth(sys2);
bw3 = bandwidth(sys3);
bw4 = bandwidth(sys4);
bw5 = bandwidth(sys5);
figure(7)
col = {'Gain Margin','Phase Margin','BandWidth'};
row = {'EO','PSO','TLBO','DE','GA'};
dat = {num2str(Gm1),num2str(Pm1),num2str(bw1);num2str(Gm2),num2str(Pm2),num2str(bw2);num2str(Gm3),num2str(Pm3),num2str(bw3);num2str(Gm4),num2str(Pm4),num2str(bw4);num2str(Gm5),num2str(Pm5),num2str(bw5)};
uitable('columnname',col,'rowname',row,'position',[10 120 390 300],'data',dat);

%nyquist(sys1)

%% ITAE per 20 Runs
numRun   = 1:1:20;
figure(8)
EO_run      = round([0.000413451594594033,0.000413156515839728,0.000413163744221705,0.000413173326541748,0.000413154559575456,0.000413600841547894,0.000413342757822951,0.000413151295828438,0.000413369190236745,0.000414971660125962,0.000415006724348681,0.000413789710324904,0.000413151175030922,0.000413157870180387,0.000413552755795547,0.000413154275459645,0.000414004484421046,0.000413214440550178,0.000413162756579848,0.000413151198361418],10);
PSO_run     = round([0.000413486031855859,0.000413789688635183,0.000413287631125707,0.000413169674631571,0.000413598697089025,0.000413692399049493,0.000413608472333164,0.000413301514883382,0.000413498572255206,0.000413619610572107,0.000413177707181297,0.000413386878329450,0.000414028264323094,0.000413220632707500,0.000413182629189199,0.000413334351900960,0.000413289345617758,0.000413377731282742,0.000413494247283710,0.000413393122509219],10);
sanTLBO_run = round([0.000413151128762629,0.000413151662254608,0.000413151120597902,0.000413151180320176,0.000413151119945102,0.000413151831266061,0.000413151119974145,0.000413151119905851,0.000413151140253089,0.000413151120882923,0.000413151133363260,0.000413151594976720,0.000413151225199322,0.000413151143841623,0.000413151119864631,0.000413151121017978,0.000413151122699897,0.000413151120954154,0.000413151156164931,0.000413151121427832],10);
DE_run      = round([0.000424985929600711,0.000450650422758853,0.000452026155113828,0.000427147055054150,0.000420664066683029,0.000419992458680689,0.000430594840914204,0.000417332358203875,0.000417611469292848,0.000437617077216491,0.000448603317794508,0.000422025379408465,0.000415874875608873,0.000446653245330550,0.000416288315330629,0.000415524790089617,0.000423922620308447,0.000417879278648304,0.000413737439221813,0.000437123468054479],10);
GA_run      = round([0.000495335288996355,0.000878625095816860,0.000420705567369968,0.000431410827847092,0.00210716639727583,0.00114344451269512,0.000560735796397955,0.000640331271184476,0.000447046152194916,0.00122806054618752,0.00172838688149894,0.000442925894873982,0.000578931720271599,0.000690102843538179,0.000574709055765741,0.000818018227224765,0.000418725789973355,0.000501528681247767,0.00195200272489971,0.000830803523476154],10);

plot(numRun,EO_run,'b','LineWidth',1.5);
hold on
plot(numRun,PSO_run,'g','LineWidth',1.5);
plot(numRun,sanTLBO_run,'m-o','LineWidth',1.5);
plot(numRun,DE_run,'r-o','LineWidth',1.5);
plot(numRun,GA_run,'y-o','LineWidth',1.5);


legend('EO','PSO','TLBO','DE','GA');
xlim([1 20]);
% set(gca, 'XTick',numRun); 
xlabel('Number of runs');
ylabel('ITAE');
hold off


%% Statistical KPI's

col = {'EO','PSO','TLBO','DE','GA'};
row = {'Maximum','Minimum','Mean','Median','Standard deviation'};
dat = {num2str(max(EO_run)),num2str(max(PSO_run)),num2str(max(sanTLBO_run)),num2str(max(DE_run)),num2str(max(GA_run));...
       num2str(min(EO_run)),num2str(min(PSO_run)),num2str(min(sanTLBO_run)),num2str(min(DE_run)),num2str(min(GA_run));...
       num2str(mean(EO_run)),num2str(mean(PSO_run)),num2str(mean(sanTLBO_run)),num2str(mean(DE_run)),num2str(mean(GA_run));...
       num2str(median(EO_run)),num2str(median(PSO_run)),num2str(median(sanTLBO_run)),num2str(median(DE_run)),num2str(median(GA_run));...
       num2str(std(EO_run)),num2str(std(PSO_run)),num2str(std(sanTLBO_run)),num2str(std(DE_run)),num2str(std(GA_run))...
       };

figure(9);
uitable('columnname',col,'rowname',row,'position',[10 120 550 300],'data',dat);


%% ITAE per 50 Iterations
numIter   = 1:1:50;
figure(10)

EO_iter      = round([0.00200409083242481;0.00200409083242481;0.000896877227580436;0.000896877227580436;0.000896877227580436;0.000855444725274868;0.000855444725274868;0.000855444725274868;0.000806498116547722;0.000529329431012547;0.000529329431012547;0.000443470753052598;0.000443470753052598;0.000443470753052598;0.000443470753052598;0.000443470753052598;0.000443470753052598;0.000443470753052598;0.000443470753052598;0.000442605716452910;0.000431980670766396;0.000425944269106475;0.000425944269106475;0.000425944269106475;0.000415592745253694;0.000415592745253694;0.000415592745253694;0.000415592745253694;0.000414116043821437;0.000414116043821437;0.000414116043821437;0.000413617711786456;0.000413617711786456;0.000413290591880668;0.000413269880807274;0.000413269880807274;0.000413269880807274;0.000413190645573452;0.000413190645573452;0.000413173603249182;0.000413162511357014;0.000413162511357014;0.000413157036017222;0.000413157036017222;0.000413151743096942;0.000413151288166919;0.000413151288166919;0.000413151211567688;0.000413151189596844;0.000413151175030922]',10);
PSO_iter     = round([0.000738433140028672;0.000738433140028672;0.000738433140028672;0.000556688986047194;0.000527169327769726;0.000480714085164903;0.000453883174820295;0.000453883174820295;0.000448731641784347;0.000448731641784347;0.000448731641784347;0.000448731641784347;0.000439526071918458;0.000429295274438084;0.000421600456251475;0.000416283314587229;0.000415223670532388;0.000415223670532388;0.000415223670532388;0.000414590241209302;0.000414590241209302;0.000414590241209302;0.000414590241209302;0.000414439780831293;0.000414439780831293;0.000414140187708404;0.000413254829179853;0.000413254829179853;0.000413254829179853;0.000413254829179853;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413250469855816;0.000413201708039657;0.000413201708039657;0.000413169674631571;0.000413169674631571;0.000413169674631571;0.000413169674631571;0.000413169674631571;0.000413169674631571;0.000413169674631571;0.000413169674631571]',10);
sanTLBO_iter = round([0.000482843306132701;0.000482843306132701;0.000482843306132701;0.000482843306132701;0.000479936451171852;0.000479936451171852;0.000479936451171852;0.000454941089536530;0.000453151338348049;0.000452194195043925;0.000420686558798428;0.000420686558798428;0.000420686558798428;0.000420686558798428;0.000420686558798428;0.000420686558798428;0.000414586843709192;0.000414586843709192;0.000414586843709192;0.000414586843709192;0.000414160680657846;0.000413952757748282;0.000413185790436474;0.000413185790436474;0.000413185790436474;0.000413185790436474;0.000413185790436474;0.000413185790436474;0.000413168922560054;0.000413156338138106;0.000413156338138106;0.000413154449555852;0.000413151370175005;0.000413151370175005;0.000413151370175005;0.000413151293177297;0.000413151149757703;0.000413151149757703;0.000413151149757703;0.000413151127348353;0.000413151127098789;0.000413151127098789;0.000413151121007650;0.000413151121007650;0.000413151121007650;0.000413151120819471;0.000413151120819471;0.000413151120079242;0.000413151120036791;0.000413151119864631]',10);
DE_iter      = round([0.00244068474575149;0.00244068474575149;0.00244068474575149;0.00178150279574910;0.00130439137056261;0.00130439137056261;0.00130439137056261;0.00130439137056261;0.00115901254346168;0.000934535876843385;0.000898348495825057;0.000888427221554049;0.000515998781712734;0.000515998781712734;0.000474195165885473;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000470333606111091;0.000449185385687663;0.000449185385687663;0.000449185385687663;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000435416725374226;0.000426182859531047;0.000426182859531047;0.000416310100545845;0.000416310100545845;0.000416310100545845;0.000416310100545845;0.000413737439221813]',10);
GA_iter      = round([0.00217584644726704;0.00217198713256440;0.00198069123470570;0.00198017470603066;0.00190367268106916;0.00190241993971152;0.00187212700897292;0.00185088649804227;0.00177538090561956;0.00177538090561956;0.00172714042055083;0.00168078019096892;0.00159946315529990;0.00156725935110146;0.00155091930801651;0.00146945554300772;0.00146714139714576;0.00145539756772520;0.00137168439037117;0.00136341952432979;0.00123821246516783;0.00115548114588564;0.00114706743489138;0.00114706743489138;0.00108399938433447;0.00106404638753529;0.000951707351085352;0.000951707351085352;0.000859710924717251;0.000859193673549327;0.000848970506760250;0.000743689769012682;0.000606396887098383;0.000474318547805872;0.000472607516196568;0.000472383673930139;0.000472256129872172;0.000471812680084626;0.000420310620956535;0.000420310620956535;0.000419396900610516;0.000419322962927270;0.000419322962927270;0.000418795506310104;0.000418760787042847;0.000418760787042847;0.000418727336848913;0.000418726182353318;0.000418725882258737;0.000418725789973355]',10);

plot(numIter,EO_iter,'--b','LineWidth',1.25);
hold on
plot(numIter,PSO_iter,'--g','LineWidth',1.25);
plot(numIter,sanTLBO_iter,'--m','LineWidth',1.25);
plot(numIter,DE_iter,'--y','LineWidth',1.25);
plot(numIter,GA_iter,'--r','LineWidth',1.25);

legend('EO','PSO','TLBO','DE','GA');
xlim([1 50]);
% set(gca, 'XTick',numIter); 
xlabel('Iteration');
ylabel('ITAE');
hold off


%% Run using bar graph
figure(11)
%barData = round([0.000413498082259106,0.000413470476215757,0.000413151879777608,0.000417443576141534,0.00221385960009131;0.000413157397665200,0.000413365111261940,0.000413151147892798,0.000437161671338831,0.00108981359976501;0.000413208004392857,0.000413433445279390,0.000413151120595976,0.000415031700891045,0.000689712146430146;0.000413152025087792,0.000413909509981132,0.000413151120707369,0.000423928262025217,0.000453072172469036;0.000413178469599503,0.000413951282975371,0.000413151121718238,0.000461357369978070,0.00255434464475871;0.000413286646764438,0.000413284939368944,0.000413151122304684,0.000499525481267376,0.000811051298467164;0.000413154677821772,0.000413230518244076,0.000413151204829385,0.000414905283018385,0.00142755177518124;0.000413213751979472,0.000413695091221565,0.000413151123633383,0.000426725715990062,0.000555748198892259;0.000421695969363291,0.000413396853830541,0.000413153544671798,0.000434697913715152,0.000477364084597943;0.000413155168949435,0.000414086365835256,0.000413151120142850,0.000416642147704064,0.00217060867232037;0.000413185595643891,0.000413164470171159,0.000413151121930555,0.000418351894074094,0.000659945779916665;0.000413169356791267,0.000414296681163592,0.000413151136331433,0.000421254250318025,0.000538139274461591;0.000413153220294573,0.000413946942323456,0.000413151344122098,0.000414273710798665,0.00162681788725084;0.000414020070752761,0.000413624383572889,0.000413151285497814,0.000419258325058089,0.000462799714759274;0.000413151142438239,0.000413245364087802,0.000413151119948193,0.000419497960764602,0.000612907262749904;0.000414183642745895,0.000413216148655294,0.000413151125312027,0.000426101276874221,0.00124131056073735;0.000413151218423307,0.000413394737755176,0.000413151146990576,0.000419203548376859,0.000545476156140047;0.000413178772186513,0.000413330409217119,0.000413151123160771,0.000445778642739762,0.000595395692215302;0.000413160576673015,0.000413335330161847,0.000413151119858262,0.000419496580911057,0.00101583327441429;0.000413151119863526,0.000413478958373956,0.000413151248754540,0.000457140671187390,0.000540100774961669;0.000413168335596746,0.000413251232861046,0.000413151308081902,0.000415003209293874,0.000690345359176114;0.000413151146059300,0.000413400544469716,0.000413151159417200,0.000496119993393951,0.00103392015386548;0.000414196345453575,0.000413361253071235,0.000413151199907349,0.000418826047432643,0.000650873775439393;0.000413170918241221,0.000413167284793522,0.000413151221570403,0.000415684023743109,0.000489256197584184;0.000413206551079038,0.000413154132844809,0.000413151122330758,0.000424485473185246,0.00145773854041333;0.000413163687216987,0.000413184572220652,0.000413151120006038,0.000417546064612187,0.000895189764597751;0.000414478480840879,0.000413165968517833,0.000413151151278401,0.000428558542069510,0.00123230255818695;0.000413153793608078,0.000413390492516795,0.000413151153623602,0.000418801719352826,0.00175889544652085;0.000413153970868241,0.000413176770643567,0.000413151119882853,0.000417369868234742,0.00141007743003253;0.000419826422755555,0.000413236993359889,0.000413151124798450,0.000420464075241121,0.000691515983523592],10);

barData(:,1) = EO_run';
barData(:,2) = PSO_run';
barData(:,3) = sanTLBO_run';
barData(:,4) = DE_run';
barData(:,5) = GA_run';

bar(barData);
legend('EO','PSO','TLBO','DE','GA');
set(gca, 'XTick',numRun); 
xlabel('Number of runs');
ylabel('ITAE');

%% Run using boxplot
boxData(:,1) = EO_run';
boxData(:,2) = PSO_run';
boxData(:,3) = sanTLBO_run';
boxData(:,4) = DE_run';
boxData(:,5) = GA_run';

figure(12)
boxplot(boxData,'labels',{'EO','PSO','TLBO','DE','GA'});
set(gca, 'XTick',numRun); 
ylabel('ITAE');
% legend('EO','PSO','TLBO','DE','GA');


%% Performance Index
SP = 1;

[y1,t1] = step(SP*sys1);
Ess1 = abs(SP - y1(end));
Mp1  = info1.Overshoot/100;
Tr1  = info1.RiseTime;
Ts1  = info1.SettlingTime;


[y2,t2] = step(SP*sys2);
Ess2 = abs(SP - y2(end));
Mp2  = info2.Overshoot/100;
Tr2  = info2.RiseTime;
Ts2  = info2.SettlingTime;

[y3,t3] = step(SP*sys3);
Ess3 = abs(SP - y3(end));
Mp3  = info3.Overshoot/100;
Tr3  = info3.RiseTime;
Ts3  = info3.SettlingTime;

[y4,t4] = step(SP*sys4);
Ess4 = abs(SP - y4(end));
Mp4  = info4.Overshoot/100;
Tr4  = info4.RiseTime;
Ts4  = info4.SettlingTime;

[y5,t5] = step(SP*sys5);
Ess5 = abs(SP - y5(end));
Mp5  = info5.Overshoot/100;
Tr5  = info5.RiseTime;
Ts5  = info5.SettlingTime;

W1 = W_index(Mp1,Tr1,Ts1,Ess1);
W2 = W_index(Mp2,Tr2,Ts2,Ess2);
W3 = W_index(Mp3,Tr3,Ts3,Ess3);
W4 = W_index(Mp4,Tr4,Ts4,Ess4);
W5 = W_index(Mp5,Tr5,Ts5,Ess5);

figure(13)
X = categorical({'EO','PSO','TLBO','DE','GA'});
X = reordercats(X,{'EO','PSO','TLBO','DE','GA'});
Y = [W1,W2,W3,W4,W5];
bar(X,Y,'b');
ylabel('W performance index');
grid on


%%====================== SIMULINK===========================
%% Disturbance
k1 = kEO;
k2 = kPSO;
k3 = kSanTLBO;
k4 = kDE;
k5 = kGA;
k6 = OBL_HGSO;
k7 = HGSO;
%%
figure(14)
%Ref
plot(out.w_ref_EO_PID.Time,out.w_ref_EO_PID.Data,'k--','LineWidth',0.5);
hold on;
%EO
plot(out.w_out_EO_PID.Time,out.w_out_EO_PID.Data,'b--','LineWidth',1.5);
%PSO
plot(out.w_out_PSO_PID.Time,out.w_out_PSO_PID.Data,'m--','LineWidth',1.5);
%TLBO
plot(out.w_out_TLBO_PID.Time,out.w_out_TLBO_PID.Data,'c:','LineWidth',1.5);
%DE
plot(out.w_out_DE_PID.Time,out.w_out_DE_PID.Data,'g-.','LineWidth',1.5);
%GA
plot(out.w_out_GA_PID.Time,out.w_out_GA_PID.Data,'r--','LineWidth',1.5);
%FLC
plot(out.w_out_FLC.Time,out.w_out_FLC.Data,'b','LineWidth',1.5);

%For comparison Purposes:
plot(out.w_out_OBL_HGSO_PID.Time,out.w_out_OBL_HGSO_PID.Data,'b','LineWidth',1.5);
plot(out.w_out_HGSO_PID.Time,out.w_out_HGSO_PID.Data,'b','LineWidth',1.5);


% set(gca, 'YTick',scaleY);   
xlabel('Time (s)');
ylabel('Speed');
title('Step Response');
%legend('','EO-PID','PSO-PID','TLBO-PID','DE-PID','GA-PID','FLC');
%For comparison Purposes:
legend('','EO-PID','PSO-PID','TLBO-PID','DE-PID','GA-PID','FLC','OBL/HGSO','HGSO');
ylim([0,1.2]);

hold off;

%% Control signal [ u(t)]

col = {'Energy','Umax'};
row = {'EO','PSO','TLBO','DE','GA'};
dat = {num2str(out.u_energy_EO.Data(end)),num2str(max(out.u_signal_EO.Data));...
       num2str(out.u_energy_PSO.Data(end)),num2str(max(out.u_signal_PSO.Data));...
       num2str(out.u_energy_TLBO.Data(end)),num2str(max(out.u_signal_TLBO.Data));...
       num2str(out.u_energy_DE.Data(end)),num2str(max(out.u_signal_DE.Data));...
       num2str(out.u_energy_GA.Data(end)),num2str(max(out.u_signal_GA.Data))...
       };

figure(15)
uitable('columnname',col,'rowname',row,'position',[10 120 550 300],'data',dat);

%% Fuzzy Time-Domain Response & Robustness Analysis:

inf1 = stepinfo(out.w_out_EO_PID.Data   , out.w_out_EO_PID.Time);
inf2 = stepinfo(out.w_out_PSO_PID.Data  , out.w_out_PSO_PID.Time);
inf3 = stepinfo(out.w_out_TLBO_PID.Data , out.w_out_TLBO_PID.Time);
inf4 = stepinfo(out.w_out_DE_PID.Data   , out.w_out_DE_PID.Time);
inf5 = stepinfo(out.w_out_GA_PID.Data   , out.w_out_GA_PID.Time);

fuzzInfo = stepinfo(out.w_out_FLC.Data, out.w_out_FLC.Time);



%% For comparison purposes

numer6 = [Kt*k6(3) Kt*k6(1) Kt*k6(2)];
denom6 = [La*Jm (La*Bm + Ra*Jm + Kt*k6(3)) (Ra*Bm + Kb*Kt + Kt*k6(1))  Kt*k6(2)];
sys6 = tf(numer6, denom6);
  
numer7 = [Kt*k7(3) Kt*k7(1) Kt*k7(2)];
denom7 = [La*Jm (La*Bm + Ra*Jm + Kt*k7(3)) (Ra*Bm + Kb*Kt + Kt*k7(1))  Kt*k7(2)];
sys7 = tf(numer7, denom7);